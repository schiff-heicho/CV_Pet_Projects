# Триггеры базы данных <ВинТех>

## Автоматизация бизнес-процессов

Проект реализует 3 ключевых триггера для автоматизации работы базы данных <ВинТех>:

### 1. Триггер обновления инвентаря
**Назначение:**
- Автоматически уменьшает остатки вина при оформлении заказа
- Контролирует актуальность данных о наличии товара

**Срабатывает:**
При добавлении новой позиции в заказ (`order_details`)

**Логика:**
Находит соответствующий складской остаток и уменьшает его на количество заказанных бутылок

---

### 2. Триггер лояльности клиентов
**Назначение:**
- Автоматически присваивает статус VIP-клиента
- Анализирует совокупные покупки клиента

**Срабатывает:**
После создания нового заказа (`orders`)

**Логика:**
При достижении суммы покупок >50,000 руб. активирует карту лояльности

---

### 3. Триггер истории цен
**Назначение:**
- Ведет полный аудит изменений цен
- Поддерживает версионность данных (SCD Type 2)

**Срабатывает:**
При обновлении цены вина (`wines.price`)

**Логика:**
1. Архивирует предыдущую цену с датой окончания
2. Добавляет новую запись с текущей датой

## Преимущества реализации
✔ Гарантированная согласованность данных
✔ Устранение ручных операций
✔ Поддержка бизнес-аналитики
✔ Соответствие требованиям аудита
