# Концептуальная модель базы данных "Физтех.вино"

![Логическая модель](docs/conceptual_model/conceptual_model.png)

## Сущности и их связи

### **wine_regions** (регионы производства вина)
- **Описание**: Хранит информацию о регионах, где производятся вина (название, страна, климат).
- **Связи**:
  - **wines**: Один регион → много вин (`region_id` в `wines` ссылается на `wine_regions.region_id`).

---

### **wines** (вина)
- **Описание**: Содержит данные о винах (название, год производства, тип, цена, рейтинг).
- **Связи**:
  - **wine_regions**: Каждое вино относится к одному региону (связь "многие к одному").
  - **wine_price_history**: Одно вино → много записей об изменении цены (`wine_id`).
  - **inventory**: Одно вино может храниться в нескольких магазинах (`wine_id`).
  - **order_details**: Одно вино может быть в нескольких заказах (`wine_id`).

---

### **wine_price_history** (история изменения цен)
- **Описание**: Фиксирует изменение цен на вина с течением времени.
- **Связи**:
  - **wines**: Каждая запись относится к одному вину (`wine_id`).

---

### **locations** (магазины)
- **Описание**: Содержит данные о магазинах (название, адрес, тип: онлайн/офлайн).
- **Связи**:
  - **inventory**: Один магазин → много записей о содержание склада (`location_id`).
  - **orders**: Заказы привязаны к магазинам (`location_id`).

---

### **customers** (клиенты)
- **Описание**: Хранит информацию о клиентах (имя, фамилия, email, город, карта лояльности).
- **Связи**:
  - **orders**: Один клиент → много заказов (`customer_id`).

---

### **orders** (заказы)
- **Описание**: Фиксирует заказы клиентов (дата, тип, статус, магазин).
- **Связи**:
  - **customers**: Каждый заказ принадлежит одному клиенту (`customer_id`).
  - **locations**: Заказ привязан к магазину (`location_id`).
  - **order_details**: Один заказ → много детали (`order_id`).

---

### **order_details** (детали заказа)
- **Описание**: Указывает, какие вина и в каком количестве были заказаны.
- **Связи**:
  - **orders**: Каждая деталь относится к одному заказу (`order_id`).
  - **wines**: Каждая деталь связана с одним вином (`wine_id`).

---

### **inventory** (складские запасы)
- **Описание**: Управляет остатками вин в магазинах.
- **Связи**:
  - **wines**: Запись о запасе относится к одному вину (`wine_id`).
  - **locations**: Запас привязан к магазину (`location_id`).

---

## Пример использования
1. Клиент из Москвы (`customers`) оформляет онлайн-заказ (`orders`) через магазин "Физтех.вино-Онлайн" (`locations`).
2. В заказ добавляются 2 бутылки вина "Barolo Riserva" (`order_details`).
3. Система проверяет наличие вина в `inventory` и обновляет остатки.
4. Цена вина берется из актуальной записи в `wine_price_history`.
5. Посчитаем итоговую цену заказа - суммирование (цена * количество)
